<Rule Name="ExampleCorrelationRule" Type="Advanced" ID="UniqueID987654">
    <Description>
        This rule detects anomalous login patterns from a specific user. It triggers when the number of failed login attempts exceeds the defined threshold within a 5-minute window.
    </Description>
    <Query>
        <FromClause>
            <Table Name="Event" Alias="event1" AliasType="Positive" />
        </FromClause>
        <WhereClause TimeWindowSize="5" TimeUnit="Minute" Threshold="3">
            <Condition ConditionType="Positive" TableAlias="event1">
                <BasicCondition Operator="Equals" JoinCondition="No" Negated="No" TableAlias="event1" IgnoreCase="No">
                    <Variable TableAlias="event1" Column="destinationUserName" />
                    <Constant>malicious_user</Constant>
                </BasicCondition>
            </Condition>
        </WhereClause>
        <GroupByClause>
            <Variable TableAlias="event1" Column="sourceAddress" />
        </GroupByClause>
    </Query>
    <Actions>
        <Action Event="OnFirstEvent">
            <SendToConsole />
        </Action>
        <Action Event="OnFirstEvent">
            <SetEventField EventFieldName="agentSeverity" EventFieldValue="High" />
        </Action>
        <Action Event="OnFirstEvent" Enabled="true">
            <SendToNotifier AckRequired="Yes" NotificationMessage="Anomalous login pattern detected for user 'malicious_user'.">
                <Resource URI="/All Destinations/SOC Operators/" ID="UniqueDestinationID" ReferenceID="CustomDestinationReference" />
            </SendToNotifier>
        </Action>
        <Action Event="OnRepeatEvent" Enabled="true">
            <SendToNotifier AckRequired="No" NotificationMessage="Anomalous login pattern continues for user 'malicious_user'.">
                <Resource URI="/All Destinations/SOC Operators/" ID="UniqueDestinationID" ReferenceID="CustomDestinationReference" />
            </SendToNotifier>
        </Action>
        <Action Event="OnThresholdExceeded" Enabled="true">
            <CreateNewCase CaseName="Anomalous Login Pattern - User 'malicious_user'" CaseDescription="Case for anomalous login pattern" Priority="2" Status="Unassigned">
                <CaseGroup>
                    <Resource URI="/All Cases/CustomCasePath" ID="UniqueCaseGroupID" ReferenceID="CustomCaseGroupReference" />
                </CaseGroup>
            </CreateNewCase>
        </Action>
    </Actions>
</Rule>
