<Rule Name="MaliciousWebRequestsRule" Type="Advanced" ID="UniqueID123456">
    <Description>
        This rule detects malicious web requests based on a set of predefined criteria. When a web request matches these criteria, it triggers an alert for further investigation.
    </Description>
    <Query>
        <FromClause>
            <Table Name="WebEvents" Alias="webEvent" AliasType="Positive" />
        </FromClause>
        <WhereClause TimeWindowSize="5" TimeUnit="Minute">
            <Condition ConditionType="Positive" TableAlias="webEvent">
                <BasicCondition Operator="Or" JoinCondition="No" Negated="No" TableAlias="webEvent">
                    <Variable TableAlias="webEvent" Column="userAgent" />
                    <PatternMatch Operator="Matches" IgnoreCase="Yes">.*(maliciousagent|bot|spider).*</PatternMatch>
                    
                    <Variable TableAlias="webEvent" Column="requestSize" />
                    <NumericComparison Operator="GreaterThanOrEqualTo">10000</NumericComparison>
                    
                    <Variable TableAlias="webEvent" Column="sourceIp" />
                    <Resource ID="UniqueIPListID" URI="/All Lists/MaliciousIPs" ReferenceID="IPListReference" />
                </BasicCondition>
            </Condition>
        </WhereClause>
    </Query>
    <Actions>
        <Action Event="OnFirstEvent">
            <SendToConsole />
        </Action>
        <Action Event="OnFirstEvent">
            <SetEventField EventFieldName="agentSeverity" EventFieldValue="High" />
        </Action>
        <Action Event="OnFirstEvent" Enabled="true">
            <SendToNotifier AckRequired="Yes" NotificationMessage="Malicious Web Request Detected">
                <Resource URI="/All Destinations/SOC Operators/" ID="UniqueDestinationID" ReferenceID="CustomDestinationReference" />
            </SendToNotifier>
        </Action>
        <Action Event="OnRepeatEvent" Enabled="true">
            <SendToNotifier AckRequired="No" NotificationMessage="Malicious Web Request Repeated">
                <Resource URI="/All Destinations/SOC Operators/" ID="UniqueDestinationID" ReferenceID="CustomDestinationReference" />
            </SendToNotifier>
        </Action>
    </Actions>
</Rule>
